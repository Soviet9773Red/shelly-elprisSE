// @license https://github.com/jisotalo/shelly-porssisahko-en 
// (c) Jussi isotalo - http://jisotalo.fi
// SE1-4 https://github.com/Soviet9773Red/shelly-elprisSE anpassad av https://github.com/Soviet9773Red 
// Big thx 2 GPTo1
// License: GNU AGPL v3.0
const CNST={INST_COUNT:"undefined"==typeof INSTANCE_COUNT?3:INSTANCE_COUNT,HIST_LEN:"undefined"==typeof HIST_LEN?24:HIST_LEN,ERR_LIMIT:3,ERR_DELAY:120,DEF_INST_ST:{chkTs:0,st:0,str:"",cmd:-1,configOK:0,fCmdTs:0,fCmd:0},DEF_CFG:{COM:{g:"SE3",vat:0,day:0,night:0,names:[]},INST:{en:0,mode:0,m0:{c:0},m1:{l:0},m2:{p:24,c:0,l:-999,s:0,m:999,ps:0,pe:23,ps2:0,pe2:23,c2:0},b:0,e:0,o:[0],f:0,fc:0,i:0,m:60,oc:0}}};let _={s:{v:"3.1.1SE-rc",dn:"",configOK:0,timeOK:0,errCnt:0,errTs:0,upTs:0,tz:"+01:00",tzh:0,enCnt:0,p:[{ts:0,now:0,low:0,high:0,avg:0},{ts:0,now:0,low:0,high:0,avg:0}]},si:[CNST.DEF_INST_ST],p:[[],[]],h:[],c:{c:CNST.DEF_CFG.COM,i:[CNST.DEF_CFG.INST]}},_i=0,_j=0,_k=0,_inc=0,_cnt=0,_start=0,_end=0,cmd=[],prevEpoch=0,loopRunning=!1;function loop(){try{if(!loopRunning){loopRunning=!0;updateState();if(_.s.configOK){if(pricesNeeded(0))getPrices(0);else if(pricesNeeded(1))getPrices(1);else{for(let e=0;e<CNST.INST_COUNT;e++)if(!_.si[e].configOK)return void getConfig(e);for(let e=0;e<CNST.INST_COUNT;e++)if(function(e){var t=_.si[e],s=_.c.i[e];if(1!=s.en)return void(_.h[e]=[]);var e=new Date,n=new Date(1e3*t.chkTs);return 0==t.chkTs||n.getHours()!=e.getHours()||n.getFullYear()!=e.getFullYear()||0<t.fCmdTs&&t.fCmdTs-epoch(e)<0||0==t.fCmdTs&&s.m<60&&e.getMinutes()>=s.m&&t.cmd+s.i==1}(e))return void Timer.set(500,!1,logic,e);"function"==typeof USER_LOOP&&USER_LOOP();loopRunning=!1}}else getConfig(-1)}}catch(e){log("error at main loop:"+e);loopRunning=!1}}function getKvsKey(e){let t="elpris";return t=0<=e?t+"-"+(e+1):t}function isCurrentHour(e,t){t-=e;return 0<=t&&t<3600}function limit(e,t,s){return Math.min(s,Math.max(e,t))}function epoch(e){return Math.floor((e?e.getTime():Date.now())/1e3)}function getDate(e){return e.getDate()}function updateTz(e){let t=e.toString(),s=0;"+0000"==(t=t.substring(3+t.indexOf("GMT")))?(t="Z",s=0):(s=+t.substring(0,3),t=t.substring(0,3)+":"+t.substring(3));t!=_.s.tz&&(_.s.p[0].ts=0);_.s.tz=t;_.s.tzh=s}function log(e){print("elpris-SE: "+e)}function addHistory(e){for(var t=0<_.s.enCnt?CNST.HIST_LEN/_.s.enCnt:CNST.HIST_LEN;0<CNST.HIST_LEN&&_.h[e].length>=t;)_.h[e].splice(0,1);_.h[e].push([epoch(),cmd[e]?1:0,_.si[e].st])}function reqLogic(){for(let e=0;e<CNST.INST_COUNT;e++)_.si[e].chkTs=0}function updateState(){var e=new Date,t=(_.s.timeOK=null!=Shelly.getComponentStatus("sys").unixtime&&2e3<e.getFullYear(),_.s.dn=Shelly.getComponentConfig("sys").device.name,epoch(e));if(_.s.timeOK&&300<Math.abs(t-prevEpoch)){log("Time changed 5 min+ -> refresh");_.s.p[0].ts=0;_.s.p[0].now=0;_.s.p[1].ts=0;_.p[1]=[]}prevEpoch=t;_.s.enCnt=0;_i=0;for(;_i<CNST.INST_COUNT;_i++)_.c.i[_i].en&&_.s.enCnt++;!_.s.upTs&&_.s.timeOK&&(_.s.upTs=epoch(e))}function pricesNeeded(e){var t=new Date;let s=!1;s=1==e?_.s.timeOK&&0===_.s.p[1].ts&&15<=t.getHours():(e=getDate(new Date(1e3*_.s.p[0].ts))!==getDate(t))&&(_.s.p[1].ts=0,_.p[1]=[],_.s.timeOK&&(0==_.s.p[0].ts||e));return _.s.errCnt>=CNST.ERR_LIMIT&&epoch(t)-_.s.errTs<CNST.ERR_DELAY?s=!1:_.s.errCnt>=CNST.ERR_LIMIT&&(_.s.errCnt=0),s}let apiBurl="https://www.elprisetjustnu.se/api/v1/prices/";function bldU(dStr){let region=_.c.c.g;if(!region){region="SE3"}let parts=dStr.split("-");let year=parts[0];let mDay=parts[1]+"-"+parts[2];let url=apiBurl+year+"/"+mDay+"_"+region+".json";return url}function pTimeL(tStr){let parts=tStr.split("T");let datePart=parts[0];let timePart=parts[1];let ymd=datePart.split("-");let year=parseInt(ymd[0],10);let month=parseInt(ymd[1],10)-1;let day=parseInt(ymd[2],10);let hour=parseInt(timePart.substring(0,2),10);let min=parseInt(timePart.substring(3,5),10);let sec=parseInt(timePart.substring(6,8),10);let dLocal=new Date(year,month,day,hour,min,sec);let epochSec=Math.floor(dLocal.getTime()/1e3);return epochSec}function getPrices(r){try{log("Getting prices for day "+r);let i=new Date;updateTz(i);var t=1==r?new Date(864e5+new Date(i.getFullYear(),i.getMonth(),i.getDate()).getTime()):i;let yyyy=t.getFullYear();let mm=t.getMonth()+1;if(mm<10)mm="0"+mm;let dd=t.getDate();if(dd<10)dd="0"+dd;let dStr=yyyy+"-"+mm+"-"+dd;let url=bldU(dStr);let c={url:url,timeout:5,ssl_ca:"*"};Shelly.call("HTTP.GET",c,function(tResp,errCode,errMsg){c=null;try{if(0!==errCode||null==tResp||200!==tResp.code||!tResp.body){throw Error(errCode+"("+errMsg+") - "+JSON.stringify(tResp))}let arr=JSON.parse(tResp.body);_.p[r]=[];_.s.p[r].avg=0;_.s.p[r].high=-999;_.s.p[r].low=999;_.s.p[r].maxH=-1;_.s.p[r].minH=-1;for(let i=0;i<arr.length;i++){let epochSec=pTimeL(arr[i].time_start);let price=arr[i].SEK_per_kWh;let hour=new Date(epochSec*1e3).getHours();price+=hour>=7&&hour<22?_.c.c.day:_.c.c.night;_.p[r].push([epochSec,price]);_.s.p[r].avg+=price;if(price>_.s.p[r].high){_.s.p[r].high=price;_.s.p[r].maxH=hour}if(price<_.s.p[r].low){_.s.p[r].low=price;_.s.p[r].minH=hour}}if(_.p[r].length<23){throw Error("invalid data received: only "+_.p[r].length+" hours")}_.s.p[r].avg=Math.round(_.s.p[r].avg/_.p[r].length*1e4)/1e4;_.s.p[r].ts=epoch()}catch(err){log("error getting prices: "+err);_.s.errCnt+=1;_.s.errTs=epoch();_.s.p[r].ts=0;_.p[r]=[]}if(0==r){reqLogic()}loopRunning=false;Timer.set(500,false,loop)})}catch(e){log("error getting prices: "+e);_.s.errCnt+=1;_.s.errTs=epoch();_.s.p[r].ts=0;_.p[r]=[];if(0==r)reqLogic();loopRunning=false;Timer.set(500,false,loop)}}function logic(i){try{"function"==typeof USER_CONFIG&&USER_CONFIG(i,!1);cmd[i]=!1;var e,t,s=new Date;updateTz(s);!function(){if(_.s.timeOK&&0!=_.s.p[0].ts){var t=epoch();for(let e=0;e<_.p[0].length;e++)if(isCurrentHour(_.p[0][e][0],t)){_.s.p[0].now=_.p[0][e][1];return}_.s.timeOK=!1;_.s.p[0].ts=0;_.s.errCnt+=1;_.s.errTs=epoch()}else _.s.p[0].ts,_.s.p[0].now=0}();let n=_.si[i],o=_.c.i[i];function c(e){if(null==e)loopRunning=!1;else{if(cmd[i]!=e&&(n.st=12),cmd[i]=e,o.i&&(cmd[i]=!cmd[i]),log("logic for #"+(i+1)+" done, cmd: "+e+" -> output: "+cmd[i]),1==o.oc&&n.cmd==cmd[i]){log("outputs already set for #"+(i+1));addHistory(i);n.cmd=cmd[i]?1:0;n.chkTs=epoch();loopRunning=!1}else{let t=0,s=0;for(let e=0;e<o.o.length;e++)!function(e,o,i){e="{id:"+o+",on:"+(cmd[e]?"true":"false")+"}";Shelly.call("Switch.Set",e,function(e,t,s,n){0!=t&&log("setting output "+o+" failed: "+t+" - "+s);n(0==t)},i)}(i,o.o[e],function(e){t++;e&&s++;t==o.o.length&&(s==t&&(addHistory(i),n.cmd=cmd[i]?1:0,n.chkTs=epoch(),Timer.set(500,!1,loop)),loopRunning=!1)})}}}0===o.mode?(cmd[i]=1===o.m0.c,n.st=1):_.s.timeOK&&0<_.s.p[0].ts&&getDate(new Date(1e3*_.s.p[0].ts))===getDate(s)?1===o.mode?(cmd[i]=_.s.p[0].now<=("avg"==o.m1.l?_.s.p[0].avg:o.m1.l),n.st=cmd[i]?2:3):2===o.mode&&(cmd[i]=function(e){var t=_.c.i[e],s=(t.m2.ps=limit(0,t.m2.ps,23),t.m2.pe=limit(t.m2.ps,t.m2.pe,24),t.m2.ps2=limit(0,t.m2.ps2,23),t.m2.pe2=limit(t.m2.ps2,t.m2.pe2,24),t.m2.c=limit(0,t.m2.c,0<t.m2.p?t.m2.p:t.m2.pe-t.m2.ps),t.m2.c2=limit(0,t.m2.c2,t.m2.pe2-t.m2.ps2),[]);for(_inc=t.m2.p<0?1:t.m2.p,_i=0;_i<_.p[0].length;_i+=_inc){if(!((_cnt=-2==t.m2.p&&1<=_i?t.m2.c2:t.m2.c)<=0)){var n=[];for(_start=_i,_end=_i+t.m2.p,t.m2.p<0&&0==_i?(_start=t.m2.ps,_end=t.m2.pe):-2==t.m2.p&&1==_i&&(_start=t.m2.ps2,_end=t.m2.pe2),_j=_start;_j<_end&&!(_j>_.p[0].length-1);_j++)n.push(_j);if(t.m2.s){for(_avg=999,_startIndex=0,_j=0;_j<=n.length-_cnt;_j++){for(_sum=0,_k=_j;_k<_j+_cnt;_k++)_sum+=_.p[0][n[_k]][1];_sum/_cnt<_avg&&(_avg=_sum/_cnt,_startIndex=_j)}for(_j=_startIndex;_j<_startIndex+_cnt;_j++)s.push(n[_j])}else{for(_j=0,_k=1;_k<n.length;_k++){var o=n[_k];for(_j=_k-1;0<=_j&&_.p[0][o][1]<_.p[0][n[_j]][1];_j--)n[_j+1]=n[_j];n[_j+1]=o}for(_j=0;_j<_cnt;_j++)s.push(n[_j])}if(-1==t.m2.p||-2==t.m2.p&&1<=_i)break}}let i=epoch(),c=!1;for(let e=0;e<s.length;e++)if(isCurrentHour(_.p[0][s[e]][0],i)){c=!0;break}return c}(i),n.st=cmd[i]?5:4,!cmd[i]&&_.s.p[0].now<=("avg"==o.m2.l?_.s.p[0].avg:o.m2.l)&&(cmd[i]=!0,n.st=6),cmd[i])&&_.s.p[0].now>("avg"==o.m2.m?_.s.p[0].avg:o.m2.m)&&(cmd[i]=!1,n.st=11):(_.s.timeOK?(n.st=7,e=1<<s.getHours(),(o.b&e)==e&&(cmd[i]=!0)):(cmd[i]=1===o.e,n.st=8),_.s.timeOK&&0<o.f&&(t=1<<s.getHours(),(o.f&t)==t)&&(cmd[i]=(o.fc&t)==t,n.st=10),cmd[i]&&_.s.timeOK&&s.getMinutes()>=o.m&&(n.st=13,cmd[i]=!1),_.s.timeOK&&0<n.fCmdTs&&(0<n.fCmdTs-epoch(s)?(cmd[i]=1==n.fCmd,n.st=9):n.fCmdTs=0)),"function"==typeof USER_OVERRIDE?USER_OVERRIDE(i,cmd[i],c):c(cmd[i])}catch(e){log("error running logic: "+JSON.stringify(e));loopRunning=!1}}let _avg=999,_startIndex=0,_sum=0;log("v."+_.s.v),log("URL: http://"+(Shelly.getComponentStatus("wifi").sta_ip??"192.168.33.1")+"/script/"+Shelly.getCurrentScriptId());_.c.i.pop(),_.si.pop();for(let e=0;e<CNST.INST_COUNT;e++){_.si.push(Object.assign({},CNST.DEF_INST_ST));_.c.i.push(Object.assign({},CNST.DEF_CFG.INST));_.c.c.names.push("-");_.h.push([]);cmd.push(!1)}function getConfig(g){var e=getKvsKey(g);Shelly.call("KVS.Get",{key:e},function(t,e,s){g<0?_.c.c=t?JSON.parse(t.value):{}:_.c.i[g]=t?JSON.parse(t.value):{};if("function"==typeof USER_CONFIG)USER_CONFIG(g,!0);{let t=g;var n=function(e){g<0?_.s.configOK=e?1:0:(log("config for #"+(g+1)+" read, enabled: "+_.c.i[g].en),_.si[g].configOK=e?1:0,_.si[g].chkTs=0),loopRunning=!1,Timer.set(500,!1,loop)};let e=0;if(CNST.DEF_CFG.COM||CNST.DEF_CFG.INST){var o,i=g<0?CNST.DEF_CFG.COM:CNST.DEF_CFG.INST,c=g<0?_.c.c:_.c.i[t];for(o in i)if(void 0===c[o])c[o]=i[o],e++;else if("object"==typeof i[o])for(var r in i[o])void 0===c[o][r]&&(c[o][r]=i[o][r],e++);t>=CNST.INST_COUNT-1&&(CNST.DEF_CFG.COM=null,CNST.DEF_CFG.INST=null);0<e?(t=getKvsKey(t),Shelly.call("KVS.Set",{key:t,value:JSON.stringify(c)},function(e,t,s,n){t&&log("failed to set config: "+t+" - "+s);n(0==t)},n)):n(!0)}else n(!0)}})}CNST.DEF_INST_ST=null;prevEpoch=epoch();HTTPServer.registerEndpoint("",function(s,n){try{if(loopRunning){s=null;n.code=503;n.send();return}var o=function(query){var t={};var pairs=query.split("&");for(let i=0;i<pairs.length;i++){var kv=pairs[i].split("=");t[kv[0]]=kv[1]}return t}(s.query);var i=parseInt(o.i);s=null;let e="application/json";n.code=200;let useGzip=true;var c="text/html";var r="text/javascript";if("s"===o.r){updateState();if(i>=0&&i<CNST.INST_COUNT){n.body=JSON.stringify({s:_.s,si:_.si[i],c:_.c.c,ci:_.c.i[i],p:_.p})}useGzip=false}else if("c"===o.r){updateState();if(i>=0&&i<CNST.INST_COUNT){n.body=JSON.stringify(_.c.i[i])}else{n.body=JSON.stringify(_.c.c)}useGzip=false}else if("h"===o.r){if(i>=0&&i<CNST.INST_COUNT){n.body=JSON.stringify(_.h[i])}useGzip=false}else if("r"===o.r){if(i>=0&&i<CNST.INST_COUNT){log("config changed for #"+(i+1));_.si[i].configOK=false}else{log("config changed");for(let e=0;e<CNST.INST_COUNT;e++){_.si[e].configOK=false}}_.s.configOK=false;reqLogic();if(!loopRunning){loopRunning=true;getConfig(i)}_.s.p[0].ts=0;_.s.p[1].ts=0;n.code=204;useGzip=false}else if("f"===o.r&&o.ts){if(i>=0&&i<CNST.INST_COUNT){_.si[i].fCmdTs=+(""+o.ts);_.si[i].fCmd=+(""+o.c);_.si[i].chkTs=0}n.code=204;useGzip=false}else if("s.js"===o.r){n.body=atob("H4sIAAAAAAAAA31Wa1PbOBT9K0JlGWli1KTdfkkwmbbQbTs8Ok26MzsMswhbSVRkyUhy0kzwf98r23EMZfkAjqUr3dc551oJj358P4sxjuAxCU+pnY/7EU+8XIopvw1rqUli+CsyoX1072IfH8Mruy+EXU+EEok3luBXuOdpdPLhr5jQ+HhTRpPp++npv5Pp9/gKTzy3Xuo5YwxH+JzrgiuUmVTA2zcrE4FuhTIrpGQmfbtmlsK2SxfGI54ZPUfJQvBcOI+kRn4hHcqFlSYFm4/bndrw8WbXD1crvnbI6Pb6Dzy5K3KUGO2tUYhog/JwwEXIy0ygO21WmoLhaSbsXOhkvbOtDArdmjT5hfCtTAUihfZSoT9c2Lzcri5MYR+nmvFfrA3oh4MVl1iZ+2p3ZWWoYMiy8ZtJXXgBWczqTMOFkJkVPF2jwokUX0fnlyfbHtRRtR63ftqaheMOjjjPvYiXRqaoH338MImvrqNMVF0FMChj8inka2NdKBWZXOgAE+7WOkECGl8f3ItjcXCAcXg+PBARY89vD8PVhcM0WkmdmhVTJuFeGs0W3C1i0cOvcY8ECPYGtINBMVpyi3x87wjGPUFHckb8wQHxDKCQ3Ik03uvTCOM4rkySw2DEpNbCfp6en1Fv1xu+4tKj3OSFgvRO1ppnMjnhnhNwyxY+C5WpT5YQVLIgnm6gw84owaBjAHGANyzMpM3IzSculUiRN0gZDs+FQDmfC3SIwBnicy71GJH9jWeZcA52SnpDDw6achFwUuQpBHIG5SQQfRmJJVehs3BS2EnV9ymfu5g0tTI6eKoLXTGsrslzlWQuV9ITqCaUKhCa5Nw68UV74q8G1/ThYUAPB9vewVr/mjkFoCADChQ+/Xtsxf1XqGQqluwn9GvYCRZC/Y3975UimHmwZDNjT3moXnzsGU/T0yWoxpl0XkBa0JsF13NgPWxvWv8M1GEuPJMpLSEAuDRIzZcUbOA6EhKtieBCf9tt+kwQtR0gTMb9kTxqjjEl9NwvRrLXo83SlbyuETIVv/w4FJ88t0OHMxHA0NlzNqEMGq7JrNBJKDqB4nC6Cf+Zh0Pk6b6lm8qDhfxKGnUug8ZALheghMyKDHj+cSFV2nEX7J9BbYMDH4kABWgZkMzHQcV7eGxj0GK4L1cceloxD8ANzWmXtoDHlI58XHMDOlDxwUd7g4pie56ZO+oXFgTztGYA81CSUWhCh1+xZyH1/0NwAHvUXN6ELSIeKAuRB2qG/somiLraNcVlcL9RMKR8JTYjK3xhNXrT/xNkRbJaTYIOxHxcH5cAV6g3HW5f63YAHBrraGPuhnt9IHIqhu0iZNW+hK5HIZ+hL8vG42MdAMEYItzrHqD1vYNn7r3Z34hyiPY3XfsyaMPjGEEgarch1XKnQc+HED1xCXQOzr5OLi/AjYVBIWdraOXl7U8gB4PyX670NwuUs359wUGU4G7aw2gIitf1W0ZAuYyHbokw6W+ChtXdEwHXZlLdDj9znlZjnbyJcB/Tku1vgjyTQa86cA5IWEDpnzG8qS0+gcN/BLeENj7DXIkDpmtwVEafw1R60TF0Azcu64H4sjUR4/bAREBZ05cPDIEknZo8iXG3AfWEcuLeLpWKndFOOjvanSjIO9iYwpN2pNIojC+XSw1cdX4N7V5KJ28lqPk6xtVvJfBoS5qnzG3p7w4kSECQfqA3sGhM6qHeEDXot5deQSLVOnMs1ePdT8jjEOGQeA9PcuPhQ8jhKrZwJe5Svz6UMB0gxTKek0aTbo5MHrQPgSgUMP4DC/Dx9tPlFbz2BhUtfHn0ujY9vqFdJ/XBKonhu/5boDzMe8A6EL7OJgCWhi+UR0MHIPfCAN+dLGdSc6XWmxdrvpBpKnT3s8cJv23crrXRO/GWluWoE/7Ls68ay7upvJ2AVc70t0+wxwkC8LqwAvpsJ2n7yQRqMvoPUeAF8t4LAAA=");e=r}else if("s.css"===o.r){n.body=atob("H4sIAAAAAAAAA41W227jNhB971dMNyiQeCNbsuPEkVGjXTRYoNgWRRftS9EHSqQs1hQpkJQvG/jfO6QoWfY6aF92LXIuZ+bMHGYyGsEIbvM7+LkxhgM3yhKhIILS2jqdTP4JJ+OCo6E/NXi85rZssnGuqt5iYkomxCGqlcZIhpQbFTGJTp9fkugBiKyJMYQC2V6L8lltObPPT0+z3xlFp088Z9KwFD7++gf8+PG3T7CdjWMYTfDuFTK1jwz/wuU6xd+aMh3h0fKIH/RwDwRecyWUTuFm+tPsZR4vLdvbiLJcaWK5kqlUkgVzF47km7VWjaToMXt5fHieL0FwyaKS8XVpU0jGD6xaQqGkdYkRVzx+7k8KUnFxSOFPpimRZAkV2Uc7Tm2ZwsOzdnbhK4nj79y1XnOJMYA0Vi2hJpT6Wub1Hk3q/RKOcGO5FQxeBzmT8dTFat2xYmtV5Z2wlJtc1a6WM4gLZ04EX8vIMFGkUAi2R1boEnxH/FUK2GrLtEs6LsQeg1BuakEOrb0/tyQzeFErw30DQTOBrdyy5Xn3KCHx9Ll3SdOMFUqz++6TFJgJA+UIE7Om8O7d8pQObQQbOPfWghHtqLZld+tKFYpgBMEK254aTFMO4Xuag0MkSMbE8DYTKt9cED0dP81d03pK4q7rYc50sEOmjBKcwk3ySOIFDkzeaONmrla8b6fLG0rFzGdDcGollqpEYxHpl4hLyvZoggSp+gTH1YhYBrgSP1ZnvS+KAlGcDz6omuTcHryz71GalyzfMPr+rClvB+r2oa3/Shwf4v1FqX3aZFDVtHVV9ZCFteY4ju7fyLIKzyzDOKKppEHvQvsdcT9657AZxI9RC5LlRVwk8C2vUH4ske1AmFoOuj6e+padVrr97uvy34FUq4k0NdHMRQrMd7leph8e5x/6Y0TUXe1K7ljsJoVQ3mANc8c2kbxqpQccqsT4sSMauCy49G59R7j0IxnG8wg/bNih0KRiBtqK3ADhfx4kbhdqgEYJtux29hhTtr5Dn2O7S+M8X1mnciurV5amBdfGRnnJBcVdydb3wcxUGG142ynJLnQrUwJZ2jJteU5EJxxY+8UMsoI+kVknJVGl3FAIv6yoPJRrlgf9UDtfW8UoJ7dDwVygAN6hx1VFe3SUXdOuIIp+a6JFvR+M2n/MVme5glTasi3/duYQTEbwC9nguoEtGcw0hdYZ1gpLB4kwPI34Kvkc7S1GhglEybInoRpycA832Wb1lhidScRV/wuWQt1BIFzdp7n0y9q/j+1rEQ/Cfs350DdBicsEktvuxP/gtK3/0nBF+bYHGgAECKeMxumF19vhvglSu78Bul9ft+eE+Qre4bPakpy7rXnj4eNDhcbofpk9LuYekp0mtTfcJYt4YLnoglc2iU98tB0MT7nrRhL65RXRmev5sCn+6Y+DuFZifslslyXD8TFRXr2xoEcUj7qxf9lDzb7PGqRc/n2+Qsk4cSt0PC3+65U/a0J13XqcRMLl7fs6c6Cu99M0FeJ363v5LB6/+RdfNleadQoAAA==");e="text/css"}else if("status"===o.r){n.body=atob("H4sIAAAAAAAAA5VSy04DIRT9FTIrbew8FiYupmx0ZTSauHDNAFUsjxHuzOjfewuWjrZGXUCA87jnAi2wTkvCNQthVRjCeUFb8DgEvZKj4pIwKwh3FrzTeEqUWIWlsDvWp3RqLmp6N0A/ALFuykRuBL1xTCj7VJbl3jlwr3pQzmZmgFz43m/rzm1wndFbJ2QGDG4y8gAM9pCya0fbKjZIW6HGXZdr/UZwoLZbcqeLLyDwLdYQ488PAANNjYddChgIOMHez8jGV5vH57bqsBoKMEq80xiiV/XRDHO3y3S5ye7AJgmQn/xmdol1LLv+S3bjvHfTb/Gbf8RPjj84Nd+DpzkMPV0s3Ci9V/iu1XYfK0XVmNvP/PhxqJev1+GkQEP8OAyGUL6E4hTlCf4AfmHDL9cCAAA=");e=c}else if("status.js"===o.r){n.body=atob("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");e=r}else if("history"===o.r){n.body=atob("H4sIAAAAAAAACmWNOw7CMBBEr2K5giJY6TdbUdHQcAH/AoscHLybKLk9IgSElGaKefOBQKPyyTI3uk2TatNUddlVPieN8AfFv1mtEcS6FBGkIEj4YeWuGi/UxY15HqQfZGMfI/tCvVB+gFnGXA6zotBwdSMWBLM+mUDjVz8dLPF54p0W65ZsLvPhznoPZuUvUGxSH9cAAAA=");e=c}else if("history.js"===o.r){n.body=atob("H4sIAAAAAAAAClWSUW/TMBDHv4p3KsgmabZR8dLUqYAx7WFs0hqeooi57qW18OxiXzZVWb47Sgqok/xwtny/++tndxaJRVnVufYuEltLkkX3O3KI052JBCIzzmG4Kb/fSlhQKBa0YdrbuFdOzoo7z4ZrPhwW57QpFucUCujzZxWYlioenGYDcNgHeYrNKRw603B6fXWttVJGUoQiILXBsTUXuWk4kFpP//JBSqXJPGOp1mIEYqqkelGG2BbpSpHiPx5uVwksg9y9NxIS4yKNHJX5X2KYdsajVNlGkRKZRbel3cnEHm1EZhr+6WJ2JqXKtN+8SRROXUDe+MCR+YbFLPpAnFMahCxCdVFPqbqoxTGmO3qD1Ek+rEQ+jg6tilFCYwiKSdf48KSoNE/IHb6wK0XIL3H2AUdOP8p9FMnYGelgUYL21of5pMPqsl7CNiA6mEPADfQD8Xh839K+JXZ/B/P/9fU1vAEWk25Vfi6//VyVDxVWH+t6mQXcW6WRA+OtI2PZuyggBfgXJYHjU586SaTr+14r0jtOohs+lLeYYQg+cBLpqT7q+1xzkX79ssr2bdxxLfo/Hd7yEYwCAAA=");e=r}else if("config"===o.r){n.body=atob("H4sIAAAAAAAAA5VWa4/aOBT9K1ZWVWekBohh2xECS+yU7rACMhqY9rNxTOLFsTO2A2V//TovHmaGaT8EkeN7r4/PfTiDiG0Bi4ZkHfscEI61HhqCphJHTMStVmvQthZocDQD2uw5HUZMZxzv+0IKWi1Xzp4hYOVVNmspjK/Zf7QftCBN0X04m4VzsBgvl5P534s6tMErThvvFBDiWUzZJ0JPNGZSFP8GmnJKTMEhRgOZGYuDLeY5HS7GAbKPC0ILQhfsWrDrgj0L9gbtaodm75rQLrjroO+jZcmBiSwvKWyxAcW5hl0EPjRklwoLvaYKrCnVBdD54kPYB0e3CO8PbhvV3vxIToRLTdBBEPqdL6cugsWJcZ0q3dqlcK72RZgrCZgvn8Ip+GOgMyzKhDIbqHhB72bjVJGxKMyiUhWOV5Q34ph9RockoWSzkj+LDahAIJy3w2/fBu3astZrjlN6Lqs4rM1kRJ20pxZCbpbQIqGc74HMjY2hgc4oOY8pS7jQr4dAB6ylAti+i9iesg06n4JPsATTnBuWcdoEnsq4ieoQkcQpwA4a8R3e63M0QKHwSYJFTC9Y39u8KMlBykRuqmI5MrbgIeH2f+MzEVuqTK35G2IzsT3s8RcmmzwDicxVsUGxvNocVscpVTEVZP8rKVTqrRyGlpNiUX2EiBrMuG4Kmv9pZcvTFKu9zZPctRNrabWoobrU7AbrpCk4nZYF7B2ru10HfbXe62JHs9H8eTQFs/Dr+LfKOCwT/AsSpB2fpNGFClcoPT5N7sdgOplNlr9F6VExQgFnKTNOWQS+RS9GwdsM7h/Go8fxYgkewuen94ftKYklSynIqGIycrsQ+hZ3GgD2EOwlTvlDFEAHu0N3DvIZfXaQHnIjdVHXQSByI/sBIrk2MgU3QU381rGABwtYW+jbQ2OCaiBWEiTIFOdXRev2m+loVFPW0CdVE5fhnCRZeXSTo36nA3xwvkhPFpsmerAtCojMhZtxu5M4Dv/knAM8IQHgKzTgVR7wnMhF4COpV4JbWvCMVzWL6UtOhWGYX5tR1l2/HAZINTmBTZNb8lX42sMuHkq+uSLwzxbIXu2WM9f0Wq/UF6Z3cjyNt7RivcqNOX4mWBidfAxd3Ljl181o/nVxYWS/p+rwx5v+bIdiBEplD1Jt5c2wyDEHsh6ult1KvRNCCsIZ2Qw/7piI5K4lMypuvLZ3+7GOWV+UP+jqeeI1B6l+NVEsM0jRl3/0jWdF8okUaxa3/tVe0SLV8v/7fTs+KgoAAA==");e=c}else if("config.js"===o.r){n.body=atob("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");e=r}else{n.body=atob("H4sIAAAAAAAAA61UwW7cIBC95ysovSRq1m5uVWKcQxqp6jVS7yzMrklYoMx4rVXbfy/YXtu7ihpF6gl48+a9mQFRfdBe0SFAQztbX1R5YVa6rQBXXzBW7YAkU42MCCRa2qy+9DAZslA/BU/RYFUOx4nv5A7E3kAXfCSmvCNwJHhnNDVCw94oWPWHa+MMGWlXqKQFccN7DW32TFmJKMiHjIyY0WIy6kHJmggbwRuigLdl2XVdATakkoCeWyTXFgglrx9PMPabVRiky3o8wtZ4x+uqzFBa5KQ+WmIwbiwHQ2YkfCxqsZ12aY9gQVHONQ6prnyg5MH20rYg+GdeP6SJRG/Zx5uqHILZv886U543i6HINS6mMoGTv3GhJZZvVUSpjR/uQ/bzk+sVkqQW06WCegEtxvWog5OMlWuwbOPjSdbRbdWH66cersrhtBzdzBwfQPZXq1nrH6N8f1ONQfLx8FYXZ7SpjW8D/s4+RrX/2kgy2ZjtW32csubbACLjtu+9j0Ht1TbmDapowvg+UwIS+/r4gwnWGad9V1ivZH7JhY9ma1xhnLKtBrzkOWIbj8Sv7vpsC8R0ykxfT7tLhcyoiiAJHi1kODE2rVNZ9BKufrEI1EbHdHHCSqE79meWkCGA0w+NsfpcQBdrrw/FgnGeHOHndzxLG2e4l5Hl0Kk5H6Zy7IwxLDCqRMuzuWfAbhm/j4KzTwyKCMFKBZc8z5xf8zlrWRKO6KIsha84W+NejgqJkNRtInGkgwVsAIjPsfxNTkVxLBLGx9KGw0BdlpHQUbwfSuq0eMbBL/1Vw1v4C/V8+Xc+BgAA");e=c;n.code=404}n.headers=[["Content-Type",e]];if(useGzip){n.headers.push(["Content-Encoding","gzip"])}}catch(err){log("server error: "+err);n.code=500}n.send()});Timer.set(1e4,true,loop),loop();